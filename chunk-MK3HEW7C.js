import{a as b}from"./chunk-TIFEMM4O.js";import{c as w}from"./chunk-CBIJKBRQ.js";import{Aa as g,Hb as f,O as d,Qb as M,T as c,_a as u,d as L,ea as r,jb as h,kb as v}from"./chunk-2FEQYACG.js";var o=L(b());var k=()=>window.navigator.geolocation,l=class a{geolocation=r(k());currentPosition=r(null);constructor(){this.getCurrentLocation()}getCurrentLocation(){this.geolocation().getCurrentPosition(e=>{this.currentPosition.set(e)})}getWatchPosition(){}stopWatchPosition(){this.geolocation().clearWatch}static \u0275fac=function(t){return new(t||a)};static \u0275prov=d({token:a,factory:a.\u0275fac,providedIn:"root"})};var x=["map"],p=class a{geoservice=c(l);acultural=c(w);mapDiv=f("map");map=r(null);coords=r(null);events=r(this.acultural.eventosMap());constructor(){this.coords.set(this.getCoordsCurrentPosition())}getCoordsCurrentPosition(){let e=this.geoservice.currentPosition(),t;if(!e)return t=new o.default.LatLng(41.3231,2.013304),t;let n=e.coords.latitude,i=e.coords.longitude;return t=new o.default.LatLng(n,i),t}getMapOptions(){let e=new o.default.LatLng(41.3231,2.013304);return{attributionControl:!0,doubleClickZoom:!0,center:this.coords()??e,zoomSnap:.5,zoomControl:!0,fadeAnimation:!0,zoomAnimation:!0,scrollWheelZoom:!0,dragging:!0,maxZoom:18,minZoom:6}}getOptionsMarker(e=!1){return{icon:new o.default.DivIcon({html:`<div style='color:${e?"red":"blue"};font-size:5px;text-shadow:2px 2px 1px black'>
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                  <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                </svg>  
            </div>`}),interactive:!0}}ngAfterViewInit(){if(!this.mapDiv()?.nativeElement)throw"Map is not defined";if(!this.coords())throw"latLng can't be null";let e=new o.default.LatLng(41.3231,2.013304),t=o.default.map(this.mapDiv().nativeElement,this.getMapOptions());this.map.set(t),o.default.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(t);let n=o.default.Control.extend({onAdd:m=>{let s=o.default.DomUtil.create("button","leaflet-bar text-teal-800 bg-teal-100 hover:text-blue-700 hover:bg-blue-100 animate-colors duration-300 p-3");return s.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-compass" viewBox="0 0 16 16">
  <path d="M8 16.016a7.5 7.5 0 0 0 1.962-14.74A1 1 0 0 0 9 0H7a1 1 0 0 0-.962 1.276A7.5 7.5 0 0 0 8 16.016m6.5-7.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0"/>
  <path d="m6.94 7.44 4.95-2.83-2.83 4.95-4.949 2.83 2.828-4.95z"/>
</svg>`,s.title="Centrar en mi ubicaci\xF3n",o.default.DomEvent.on(s,"click",()=>this.centerOnMe(m)),s},onRemove:m=>{}});t.addControl(new n({position:"topright"})),o.default.marker(new o.default.LatLng(+this.coords().lat,+this.coords().lng),this.getOptionsMarker(!0)).addTo(t).bindPopup("<h4>Vost\xE9 \xE9s aqu\xED</h4>"),this.generateMarkers(this.events(),t),this.map().setView(new o.LatLng(+this.coords().lat,+this.coords().lng)??new o.LatLng(+e.lat,+e.lng),13)}centerOnMe(e){let t=this.coords();e.flyTo(new o.LatLng(t.lat,t.lng),13)}generateMarkers(e,t){e.forEach(n=>{let i=o.default.marker(new o.default.LatLng(+n.lat,+n.lon),this.getOptionsMarker()).addTo(t);return i.bindPopup(`<h4>${n.denominaci}</h4><a href="${M.BASE_HREF}/init/event/${n.codi}">M\xE9s info...</a>`),i.on("click",()=>i.openPopup()),i})}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=g({type:a,selectors:[["map"]],viewQuery:function(t,n){t&1&&h(n.mapDiv,x,5),t&2&&v()},decls:2,vars:0,consts:[["map",""]],template:function(t,n){t&1&&u(0,"div",null,0)},styles:["div[_ngcontent-%COMP%]{z-index:1;width:100vw;height:100vh}@media (min-width:1024px){div[_ngcontent-%COMP%]{width:75vw;height:100vh}}"]})};export{p as default};
